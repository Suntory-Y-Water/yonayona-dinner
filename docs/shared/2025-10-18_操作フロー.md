# 最小操作フロー（MVP）

## 初回起動

1. スプラッシュ（0.5s以内）
2. 位置情報許可ダイアログ表示
3. 許可→現在地取得→地図描画（ズーム15、半径800m）
4. 許可しない→「中心を設定」ガイド表示→地図中央を長押しで中心確定

## 自動検索・表示

1. 現在地中心でNearby検索
2. 営業時間フィルタ（基準23:00、現在時刻を初期値）適用
3. 営業中ピンのみ描画
4. 0件なら半径を段階拡大（800→1200→2000m）

## 地図操作

1. パン／ピンチ→一定閾値移動で再検索（500m以上移動時）
2. 画面下の時間トグル

   - 「今開いてる」
   - 「もうすぐ閉店」(60分以内)
   - 「この後開く」(次スロット開始≤90分)

## ピン詳細（ボトムシート）

- 表示内容：店名／住所／営業時間／「閉店まであとn分」
- アクション：Googleマップを開く（経路案内委任）
- セカンダリ：電話発信（番号がある場合のみ）

## 設定（右上アイコン）

- 半径：400 / 800 / 1200
- 基準時刻：21:30〜26:00（30分刻み）
- 営業時間不明店の表示：非表示（初期）／表示

---

# 状態遷移

`未許可` →（許可）→ `現在地取得中` → `地図描画` → `検索実行中` → `結果表示`
`結果0件` → `条件緩和中（半径拡大 or 時刻±30分提案）` → `結果表示`
`ネットワーク不良` → `再試行待機（リトライボタン）`

---

# データ処理フロー(例)

1. 位置（lat, lng, 半径）確定
2. Nearby検索で place_id 一覧取得
3. Place Detailsで `opening_hours` 取得
4. 曜日スロット正規化（跨ぎ対応：例 23:30–05:00）
5. 現在時刻 ∈ スロット → 営業中
6. 残り分＝close_time−now（負なら次スロット計算）
7. 表示用モデルに整形→描画

---

# エラー時挙動

- 位置情報拒否：手動中心設定＋説明テキスト
- 営業時間なし：バッジ「時間不明」、既定は非表示
- API失敗：リトライ、簡易トーストのみ（画面遷移はしない）

---

# パフォーマンス要件（MVP）

- 起動→初回結果表示：2秒以内（4G相当）
- 再検索（パン後）：1.2秒以内

---

# アクセシビリティ

- コントラスト比 4.5:1 以上（暗色背景×白文字）
- 片手操作到達線上に主要UI（親指リーチ）

---

# MVP完了の受け入れ基準

- 位置許可あり／なしの両ケースで検索→表示が完了する
- 23:00以降、営業中のみピンが表示される
- 跨ぎ営業時間で「あとn分」が正しい
- 0件時に自動で半径拡大し1回は再検索する
- Googleマップ遷移がワンタップで動作する