## 開発手法

### 契約による設計の実装指針

TypeScript環境での契約による設計の適切な実装方法

#### 避けるべき実装パターン

- 既にTypeScriptで型保証されている引数の再チェック
- 例外を投げないライブラリ関数への不要なtry-catch
  - 例外処理は呼び出し元でキャッチするため、正常系のみを実装
- 「（契約による設計）」など装飾的なコメント
- 事前・事後・不変条件の詳細なコメント記述

#### 推奨する実装パターン

- 関数名と型定義で契約を明示
- シンプルで読みやすいコード構造
- 必要最小限のJSDocコメント
- 純粋関数としての実装（副作用なし）

### テスト方針

- メソッドの事前条件、事後条件、不変条件を検証するテストであること
- Given-When-Thenパターンに基づいて実装すること
- TDD を実施する。コードを生成するときは、それに対応するユニットテストを常に生成する。
  - コードを追加で修正したとき、テストを`AGENT=1 bun test --bail=2` で実行し、パスすることを常に確認する。
  ```ts
  function add(a: number, b: number) { return a + b }
  test("1+2=3", () => {
    expect(add(1, 2)).toBe(3);
  });
  ```

## 品質保証

### コーディング規約

- インターフェースではなくtypeを使用する
- 型安全にするため、構造的に型づけする
  - 例: `function add({a, b}: {a:number b: number}) { return a + b }`
  - アサーションが必要なデータがあるときはユーザーに許可を求める
- 関数の引数が2個以上あるときは引数をオブジェクト形式で設定する
- 見通しを良くするため、最上位の関数はfunction宣言で実装する
  - `map`や`filter`、即時関数などはアロー関数で実装する。
- クラスはこのプロジェクトでは使用しないため、関数ベースの実装を行う
  - ただし`@server/`側のバックエンドで使用するDI部分についてはクラスを利用する。
- 既存の型定義を尊重して、活用できるものがあればPickやOmitなどを使い、型は積極的に再利用する。
- 配列の型定義は`Array<T>`ではなく`[]`を使用する
- 暗黙のフォールバックは合理的な理由がない限り禁止 
- 合理的な理由のない、スイッチ引数禁止
- 合理的な理由のない、オプショナル引数・デフォルト値は禁止
- 将来的な拡張性の考慮は禁止

### ドキュメント生成規約

- ファイルは`date`コマンドで取得した日付をもとに`yyyy-mm-dd_{日本語で書いた事象名}.md`とする。
- ファイル格納先は以下とする
  - クライアントでの関連ファイル : `@docs/client`
  - サーバーでの関連ファイル : `@docs/server`
  - 両者に属さないもの：`@docs/shared`
- 

## 制約事項

- コード生成後の行動
  - 関数やコンポーネントには TsDoc コメントを必ず追加する。
  - TsDoc のコメントは初めて見た人でも使い方や入力・出力がわかる例を掲載し、説明を一切省略せず具体的に記載する。
  - `bun run ai-check`でリント、型チェックを実行します。