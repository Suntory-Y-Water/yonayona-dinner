# 要件定義書

## はじめに

「よなよなディナー」は、22時以降も営業中の飲食店だけを地図で表示するWebアプリケーションです。残業後や終電後に「今開いている店」を素早く発見したい東京都および首都圏近郊の男性サラリーマン（20代後半〜40代前半）をターゲットとし、疲れていても2タップで店舗を発見できる体験を提供します。

本アプリケーションはGoogle Places APIとGoogle Maps JavaScript APIを活用し、現在地周辺の営業中店舗をリアルタイムに表示します。MVPでは口コミや予約機能を省き、シンプルで高速な「発見→外部ナビ」体験に特化します。

## 要件

### 要件1: 位置情報の取得と地図表示
**目的:** ユーザーとして、起動と同時に現在地周辺の地図を見たい。そうすることで、迷わず素早く店舗を探し始められる。

#### 受入基準

1. WHEN ユーザーがアプリを起動した THEN よなよなディナーは位置情報パーミッションを要求する
2. IF ユーザーが位置情報パーミッションを許可した THEN よなよなディナーは現在地を中心とした地図を表示する
3. IF ユーザーが位置情報パーミッションを拒否した THEN よなよなディナーは中心位置を手動設定するガイダンスを表示する
4. WHEN 地図が初回描画される THEN よなよなディナーは起動から2秒以内に地図を表示する
5. WHERE 地図が表示されている THE よなよなディナーはダークテーマ（暗い紫または深い青を基調、白文字、アクセントに黄金色）を適用する

### 要件2: 営業中店舗の検索とフィルタリング
**目的:** ユーザーとして、現在営業中の店舗だけを見たい。そうすることで、閉店している店舗を除外し、確実に入店できる店舗だけを確認できる。

#### 受入基準

1. WHEN 地図が表示された THEN よなよなディナーは現在地から半径800メートル以内の飲食店を検索する
2. IF 店舗の営業時間情報が存在する THEN よなよなディナーは現在時刻が営業時間スロット内に含まれるかを判定する
3. IF 店舗が営業中である THEN よなよなディナーは地図上に黄金色のピンで店舗を表示する
4. IF 店舗の営業時間情報が存在しない THEN よなよなディナーはその店舗を検索結果から除外する
5. WHEN 営業時間判定を行う THEN よなよなディナーは24時跨ぎ営業時間（例：23:30–翌5:00）に対応する
6. WHEN 営業時間判定を行う THEN よなよなディナーは複数営業時間スロット（例：11:00-14:00と17:00-23:00）に対応する

### 要件3: 時間帯フィルタの調整
**目的:** ユーザーとして、検索する時間帯を調整したい。そうすることで、現在だけでなく「これから向かう時間」に営業している店を探せる。

#### 受入基準

1. WHEN 地図が表示された THEN よなよなディナーはデフォルトで23:00基準の営業中フィルタを適用する
2. WHERE 地図上に時間調整UIが配置されている THE よなよなディナーは時間帯を15分刻みで調整可能にする
3. WHEN ユーザーが時間帯を変更した THEN よなよなディナーは変更後の時間帯で営業中の店舗を再検索し、地図を更新する
4. WHERE 時間調整UIに THE よなよなディナーは22:00、23:00、24:00などのプリセット時間帯を表示する

### 要件4: 店舗詳細情報の表示
**目的:** ユーザーとして、ピンをタップして店舗の基本情報を確認したい。そうすることで、店名や閉店までの残り時間を把握し、行くべき店を決められる。

#### 受入基準

1. WHEN ユーザーが地図上のピンをタップした THEN よなよなディナーは詳細パネルを表示する
2. WHERE 詳細パネルに THE よなよなディナーは店名を表示する
3. WHERE 詳細パネルに THE よなよなディナーは住所を表示する
4. WHERE 詳細パネルに THE よなよなディナーは営業時間を表示する
5. WHERE 詳細パネルに THE よなよなディナーは閉店までの残り時間を「あとXX分」形式で表示する
6. WHEN 閉店までの残り時間を計算する THEN よなよなディナーは現在時刻と閉店時刻の差分を分単位で算出する

### 要件5: 外部ナビゲーション連携
**目的:** ユーザーとして、選んだ店舗への経路をGoogleマップで確認したい。そうすることで、アプリ内で経路を実装することなく、慣れたナビで店舗に向かえる。

#### 受入基準

1. WHERE 詳細パネルに THE よなよなディナーはGoogleマップ起動リンクを表示する
2. WHEN ユーザーがGoogleマップ起動リンクをタップした THEN よなよなディナーは店舗の位置情報を含むGoogleマップURLを開く
3. WHEN Googleマップを起動する THEN よなよなディナーは経路案内の実装をGoogleマップに委任する

### 要件6: 検索結果が0件の場合の挙動
**目的:** ユーザーとして、検索結果が0件の場合に代替案を提示してほしい。そうすることで、手動で条件を変更する手間なく、より広い範囲や時間帯で店舗を探せる。

#### 受入基準

1. IF 検索結果が0件である THEN よなよなディナーは半径を1段階拡大（例：800m→1200m）して自動再検索する
2. IF 再検索でも結果が0件である THEN よなよなディナーは時間帯フィルタを1段階緩和（例：23:00→22:00）して自動再検索する
3. IF すべての緩和策を実行しても結果が0件である THEN よなよなディナーは「周辺に営業中の店舗が見つかりませんでした」というメッセージを表示する

### 要件7: エラーハンドリング
**目的:** ユーザーとして、エラー発生時に明確な理由と対処方法を知りたい。そうすることで、混乱せずにアプリを使い続けられる。

#### 受入基準

1. IF Google Places APIの呼び出しが失敗した THEN よなよなディナーは「店舗情報の取得に失敗しました」というエラーメッセージを表示する
2. IF Google Maps JavaScript APIの読み込みが失敗した THEN よなよなディナーは静的フォールバック表示（エラーメッセージと再読み込みボタン）を提供する
3. IF 位置情報の取得がタイムアウトした THEN よなよなディナーは「位置情報の取得に失敗しました。手動で場所を設定してください」というガイダンスを表示する

### 要件8: モバイル最適化
**目的:** ユーザーとして、モバイル端末で快適に操作したい。そうすることで、片手で素早く店舗を探し、タップミスなく操作できる。

#### 受入基準

1. WHERE すべてのインタラクティブ要素（ボタン、ピン、時間調整UI）に THE よなよなディナーは親指で到達可能な位置に配置する
2. WHERE すべてのタップ可能要素に THE よなよなディナーは最小44x44ピクセルのタップ領域を確保する
3. WHEN 画面が縦向きである THEN よなよなディナーは画面下部に主要操作UIを配置する
4. WHERE テキスト表示に THE よなよなディナーはモバイル端末で読みやすいフォントサイズ（最小14px）を使用する

### 要件9: パフォーマンスとキャッシュ
**目的:** システム運用者として、APIコストを抑制しつつ高速なユーザー体験を提供したい。そうすることで、持続可能なサービス運営が可能になる。

#### 受入基準

1. WHEN 同一位置・同一時間帯での検索が繰り返された THEN よなよなディナーは前回の検索結果をキャッシュから返す
2. WHERE キャッシュに THE よなよなディナーは検索結果を5分間保持する
3. WHEN 5分が経過した THEN よなよなディナーはキャッシュを無効化し、再度API呼び出しを行う
4. WHEN APIレスポンスが遅延している THEN よなよなディナーはローディングインジケーターを表示する

### 要件10: データプライバシー
**目的:** ユーザーとして、自分の位置情報が適切に扱われていることを保証してほしい。そうすることで、安心してアプリを利用できる。

#### 受入基準

1. WHERE 位置情報の利用に THE よなよなディナーは端末内でのみ使用し、サーバーに送信しない
2. WHERE 個人情報の保存に THE よなよなディナーはいかなる個人情報もサーバーまたはローカルストレージに保存しない
3. WHERE Google API利用に THE よなよなディナーはGoogle API規約を遵守する

### 要件11: ブランドとUI
**目的:** ユーザーとして、夜間でも見やすく落ち着いた雰囲気のUIを体験したい。そうすることで、疲れた状態でもストレスなく店舗を探せる。

#### 受入基準

1. WHERE アプリ全体に THE よなよなディナーはダークテーマを固定適用する（背景：暗い紫または深い青、文字：白、アクセント：黄金色）
2. WHERE ロゴに THE よなよなディナーは白文字ロゴと右上にビールの泡が溢れる意匠を表示する
3. WHERE UIデザインに THE よなよなディナーは装飾を最小限にし、静かで落ち着いたトーンを維持する
4. WHERE ピンの色に THE よなよなディナーは営業中の店舗を黄金色で表示する

### 要件12: 計測とモニタリング
**目的:** システム運用者として、ユーザー行動とシステムパフォーマンスを計測したい。そうすることで、改善点を特定し、サービス品質を向上できる。

#### 受入基準

1. WHEN アプリが起動した THEN よなよなディナーは起動から地図表示までの時間を記録する
2. WHEN 検索が完了した THEN よなよなディナーは検索結果件数を記録する
3. WHEN 検索結果が0件である THEN よなよなディナーはゼロ件発生をカウントする
4. WHEN ユーザーがGoogleマップを起動した THEN よなよなディナーは外部マップ遷移をカウントする
5. WHEN 検索が実行された THEN よなよなディナーは時間帯別利用分布を記録する

### 要件13: スコープ外機能（MVP非対応）
**目的:** 開発チームとして、MVPで実装しない機能を明確にしたい。そうすることで、スコープクリープを防ぎ、コア体験に集中できる。

#### 受入基準

1. WHERE MVP範囲に THE よなよなディナーは口コミ・評価表示機能を含めない
2. WHERE MVP範囲に THE よなよなディナーは予約機能を含めない
3. WHERE MVP範囲に THE よなよなディナーは会員登録・お気に入り機能を含めない
4. WHERE MVP範囲に THE よなよなディナーは決済・クーポン機能を含めない
